<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE Main 2026 - Study Playlist Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        ::-webkit-scrollbar-thumb {
            background: #374151; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563; 
        }
        .video-card.active {
            background-color: #374151;
            border-left: 4px solid #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 h-screen flex flex-col overflow-hidden font-sans">

    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 h-16 flex items-center justify-between px-6 flex-shrink-0">
        <div class="flex items-center gap-3">
            <i data-lucide="graduation-cap" class="text-blue-500 w-8 h-8"></i>
            <div>
                <h1 class="text-xl font-bold tracking-tight">JEE Main 2026</h1>
                <p class="text-xs text-gray-400">Study Playlist Manager</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <!-- Export/Import Controls -->
            <button onclick="exportData()" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1 transition-colors" title="Download Backup">
                <i data-lucide="download" class="w-3 h-3"></i> Export
            </button>
            <label class="text-xs text-green-400 hover:text-green-300 cursor-pointer flex items-center gap-1 transition-colors" title="Restore Backup">
                <i data-lucide="upload" class="w-3 h-3"></i> Import
                <input type="file" id="import-file" class="hidden" accept=".json" onchange="importData(this)">
            </label>
            
            <div class="h-4 w-px bg-gray-700 mx-2"></div>

            <button onclick="resetData()" class="text-xs text-red-400 hover:text-red-300 underline">Reset</button>
            <div class="text-xs text-gray-500 bg-gray-900 px-3 py-1 rounded-full border border-gray-700">
                <span id="storage-status">Saved locally</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar: Folders -->
        <aside class="w-64 bg-gray-800 border-r border-gray-700 flex flex-col flex-shrink-0 transition-all duration-300" id="sidebar">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800 sticky top-0 z-10">
                <h2 class="font-semibold text-gray-300">My Subjects</h2>
                <button onclick="openModal('folder')" class="p-1 hover:bg-gray-700 rounded text-blue-400" title="Add Folder">
                    <i data-lucide="folder-plus" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div id="folder-list" class="flex-1 overflow-y-auto p-2 space-y-1">
                <!-- Folders injected here -->
            </div>
        </aside>

        <!-- Main Area -->
        <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
            
            <!-- Empty State -->
            <div id="empty-state" class="hidden absolute inset-0 flex flex-col items-center justify-center text-gray-500 z-0">
                <i data-lucide="play-square" class="w-16 h-16 mb-4 opacity-50"></i>
                <p class="text-lg">Select a folder and video to start studying</p>
            </div>

            <!-- Video Player Section (Left/Top) -->
            <div class="flex-1 bg-black flex flex-col relative z-10" id="player-container">
                <div class="flex-1 relative bg-black flex items-center justify-center">
                    <div id="iframe-wrapper" class="w-full h-full">
                        <!-- Iframe injected here -->
                        <div class="w-full h-full flex flex-col items-center justify-center text-gray-600 bg-gray-950">
                            <i data-lucide="monitor-play" class="w-12 h-12 mb-3"></i>
                            <p>No video selected</p>
                        </div>
                    </div>
                </div>
                <div class="h-16 bg-gray-800 border-t border-gray-700 px-6 flex items-center justify-between" id="player-controls">
                    <div>
                        <h3 id="current-video-title" class="text-sm font-medium text-white truncate max-w-md">Select a video...</h3>
                    </div>
                    <!-- Future controls could go here -->
                </div>
            </div>

            <!-- Playlist/Video List Section (Right/Bottom) -->
            <div class="w-full md:w-96 bg-gray-900 border-l border-gray-700 flex flex-col flex-shrink-0 z-10">
                <div class="p-4 border-b border-gray-700 bg-gray-900 flex justify-between items-center sticky top-0">
                    <div>
                        <h2 id="active-folder-name" class="font-bold text-lg text-white">Folder Name</h2>
                        <p id="video-count" class="text-xs text-gray-400">0 videos</p>
                    </div>
                    <div class="flex gap-1">
                        <button onclick="editCurrentFolder()" class="p-2 hover:bg-gray-800 rounded text-gray-400" title="Rename Folder">
                            <i data-lucide="edit-2" class="w-4 h-4"></i>
                        </button>
                        <button onclick="deleteCurrentFolder()" class="p-2 hover:bg-gray-800 rounded text-red-400" title="Delete Folder">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <div class="p-3 border-b border-gray-700 bg-gray-800/50">
                    <button onclick="openModal('video')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg flex items-center justify-center gap-2 text-sm font-medium transition-colors">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Add YouTube Link
                    </button>
                </div>

                <div id="video-list" class="flex-1 overflow-y-auto p-2 space-y-2 pb-20">
                    <!-- Videos injected here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add Folder Modal -->
    <div id="modal-folder" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-xl border border-gray-700 shadow-2xl w-96 p-6">
            <h3 class="text-lg font-bold mb-4">Create New Subject Folder</h3>
            <input type="text" id="input-folder-name" placeholder="e.g., Physics - Ray Optics" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white mb-4 focus:outline-none focus:border-blue-500">
            <div class="flex justify-end gap-3">
                <button onclick="closeModals()" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                <button onclick="createFolder()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded font-medium">Create</button>
            </div>
        </div>
    </div>

    <!-- Add Video Modal -->
    <div id="modal-video" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-xl border border-gray-700 shadow-2xl w-full max-w-md p-6">
            <h3 class="text-lg font-bold mb-4">Add Video to Playlist</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-400 mb-1">YouTube URL</label>
                    <input type="text" id="input-video-url" placeholder="https://youtube.com/watch?v=..." class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-xs text-gray-400 mb-1">Title (Optional)</label>
                    <input type="text" id="input-video-title" placeholder="e.g., Lecture 1: Reflection" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:outline-none focus:border-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Leave blank to use generic title.</p>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeModals()" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                <button onclick="addVideo()" class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded font-medium">Add Video</button>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div id="modal-rename" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-gray-800 rounded-xl border border-gray-700 shadow-2xl w-96 p-6">
            <h3 class="text-lg font-bold mb-4">Rename Item</h3>
            <input type="hidden" id="rename-type">
            <input type="hidden" id="rename-id">
            <input type="text" id="input-rename-value" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white mb-4 focus:outline-none focus:border-blue-500">
            <div class="flex justify-end gap-3">
                <button onclick="closeModals()" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                <button onclick="saveRename()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded font-medium">Save</button>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        let appData = {
            folders: [],
            activeFolderId: null,
            activeVideoId: null
        };

        const STORAGE_KEY = 'jee_prep_playlist_v1';

        // --- Init ---
        function init() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                appData = JSON.parse(saved);
            } else {
                // Seed Default Data
                seedDefaults();
            }
            lucide.createIcons();
            render();
        }

        function seedDefaults() {
            const id1 = generateId();
            const id2 = generateId();
            appData = {
                folders: [
                    { id: id1, name: 'Physics - Mechanics', videos: [] },
                    { id: id2, name: 'Maths - Algebra', videos: [] }
                ],
                activeFolderId: id1,
                activeVideoId: null
            };
            save();
        }

        function save() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
            document.getElementById('storage-status').innerText = 'Saved';
            setTimeout(() => document.getElementById('storage-status').innerText = 'Saved locally', 1000);
        }

        // --- Import / Export ---

        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            const date = new Date().toISOString().slice(0, 10);
            a.download = `jee-study-backup-${date}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    // Basic validation
                    if (imported.folders && Array.isArray(imported.folders)) {
                        if(confirm("This will overwrite your current study playlist. Are you sure you want to continue?")) {
                            appData = imported;
                            // Reset active items if they don't exist in new data to prevent crashes
                            if (!appData.folders.find(f => f.id === appData.activeFolderId)) {
                                appData.activeFolderId = appData.folders.length > 0 ? appData.folders[0].id : null;
                                appData.activeVideoId = null;
                            }
                            save();
                            render();
                            alert("Data imported successfully!");
                        }
                    } else {
                        alert("Invalid file format. Please upload a valid JSON backup.");
                    }
                } catch (err) {
                    alert("Error parsing file: " + err.message);
                }
                input.value = ''; // Reset input to allow same file selection again
            };
            reader.readAsText(file);
        }

        function resetData() {
            if(confirm("Are you sure you want to delete all folders and videos? This cannot be undone.")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // --- Helpers ---
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        function getYouTubeId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function getThumbnail(videoId) {
            return `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
        }

        // --- Rendering ---
        function render() {
            renderFolders();
            renderMainArea();
            lucide.createIcons();
        }

        function renderFolders() {
            const list = document.getElementById('folder-list');
            list.innerHTML = '';

            appData.folders.forEach(folder => {
                const isActive = folder.id === appData.activeFolderId;
                const el = document.createElement('div');
                el.className = `cursor-pointer flex items-center justify-between p-3 rounded-lg text-sm transition-colors ${isActive ? 'bg-blue-600/20 text-blue-400 border border-blue-500/30' : 'text-gray-400 hover:bg-gray-700/50 hover:text-gray-200'}`;
                el.onclick = () => setActiveFolder(folder.id);
                el.innerHTML = `
                    <div class="flex items-center gap-3 overflow-hidden">
                        <i data-lucide="${isActive ? 'folder-open' : 'folder'}" class="w-4 h-4 flex-shrink-0"></i>
                        <span class="truncate font-medium">${escapeHtml(folder.name)}</span>
                    </div>
                    <span class="text-xs opacity-50 bg-gray-900 px-2 py-0.5 rounded-full">${folder.videos.length}</span>
                `;
                list.appendChild(el);
            });
        }

        function renderMainArea() {
            const activeFolder = appData.folders.find(f => f.id === appData.activeFolderId);
            
            if (!activeFolder) {
                // Show empty state if no folder selected (shouldn't happen often)
                return;
            }

            // Update Header Info
            document.getElementById('active-folder-name').innerText = activeFolder.name;
            document.getElementById('video-count').innerText = `${activeFolder.videos.length} videos`;

            // Render Video List
            const videoList = document.getElementById('video-list');
            videoList.innerHTML = '';

            if (activeFolder.videos.length === 0) {
                videoList.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <p class="mb-2">This folder is empty.</p>
                        <p class="text-xs">Click "Add YouTube Link" to start building your playlist.</p>
                    </div>
                `;
            } else {
                activeFolder.videos.forEach((video, index) => {
                    const isActiveVideo = video.id === appData.activeVideoId;
                    const el = document.createElement('div');
                    el.className = `video-card group relative flex gap-3 p-3 rounded-lg cursor-pointer transition-all ${isActiveVideo ? 'active bg-gray-800' : 'bg-gray-800/30 hover:bg-gray-800'}`;
                    el.onclick = (e) => {
                        // Prevent click if clicking actions
                        if (e.target.closest('.actions')) return;
                        playVideo(video.id);
                    };

                    el.innerHTML = `
                        <div class="relative w-24 h-16 bg-gray-900 rounded overflow-hidden flex-shrink-0">
                            <img src="${video.thumbnail}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity">
                            ${isActiveVideo ? '<div class="absolute inset-0 flex items-center justify-center bg-black/50"><i data-lucide="bar-chart-2" class="text-blue-400 w-6 h-6 animate-pulse"></i></div>' : ''}
                        </div>
                        <div class="flex-1 min-w-0 flex flex-col justify-center">
                            <h4 class="text-sm font-medium text-gray-200 truncate pr-6 leading-tight mb-1">${escapeHtml(video.title)}</h4>
                            <p class="text-xs text-gray-500 font-mono">Video #${index + 1}</p>
                        </div>
                        <div class="actions absolute right-2 top-2 bottom-2 flex flex-col justify-between opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="renameVideo('${video.id}')" class="p-1 hover:text-blue-400 text-gray-500"><i data-lucide="edit-2" class="w-3 h-3"></i></button>
                            <button onclick="deleteVideo('${video.id}')" class="p-1 hover:text-red-400 text-gray-500"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                        </div>
                    `;
                    videoList.appendChild(el);
                });
            }

            // Render Player Content
            const playerContainer = document.getElementById('iframe-wrapper');
            const titleDisplay = document.getElementById('current-video-title');
            
            if (appData.activeVideoId) {
                const activeVideo = activeFolder.videos.find(v => v.id === appData.activeVideoId);
                if (activeVideo) {
                    playerContainer.innerHTML = `
                        <iframe 
                            src="https://www.youtube.com/embed/${activeVideo.videoId}?autoplay=1&rel=0&modestbranding=1" 
                            class="w-full h-full" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    `;
                    titleDisplay.innerText = activeVideo.title;
                } else {
                    // Active video might have been deleted
                    appData.activeVideoId = null;
                    renderMainArea(); 
                }
            } else {
                playerContainer.innerHTML = `
                    <div class="w-full h-full flex flex-col items-center justify-center text-gray-600 bg-gray-950">
                        <i data-lucide="monitor-play" class="w-16 h-16 mb-4 opacity-20"></i>
                        <p class="text-gray-500">Select a video from the list to play</p>
                    </div>
                `;
                titleDisplay.innerText = "No video playing";
            }
        }

        // --- Actions ---

        function setActiveFolder(id) {
            appData.activeFolderId = id;
            appData.activeVideoId = null; // Reset video on folder change
            render();
            save();
        }

        function playVideo(id) {
            appData.activeVideoId = id;
            render(); 
            // Don't save activeVideoId specifically to ensure fresh start on reload? 
            // Actually, let's save it so they pick up where left off.
            save();
        }

        function createFolder() {
            const nameInput = document.getElementById('input-folder-name');
            const name = nameInput.value.trim();
            if (!name) return;

            const newFolder = {
                id: generateId(),
                name: name,
                videos: []
            };

            appData.folders.push(newFolder);
            appData.activeFolderId = newFolder.id;
            
            nameInput.value = '';
            closeModals();
            render();
            save();
        }

        function addVideo() {
            const urlInput = document.getElementById('input-video-url');
            const titleInput = document.getElementById('input-video-title');
            
            const url = urlInput.value.trim();
            const title = titleInput.value.trim();
            const videoId = getYouTubeId(url);

            if (!videoId) {
                alert("Invalid YouTube URL");
                return;
            }

            const activeFolder = appData.folders.find(f => f.id === appData.activeFolderId);
            if (!activeFolder) return;

            const newVideo = {
                id: generateId(),
                videoId: videoId,
                title: title || `Video ${activeFolder.videos.length + 1}`,
                thumbnail: getThumbnail(videoId),
                addedAt: new Date().toISOString()
            };

            activeFolder.videos.push(newVideo);
            
            urlInput.value = '';
            titleInput.value = '';
            closeModals();
            
            // Auto play if it's the first video
            if (activeFolder.videos.length === 1) {
                appData.activeVideoId = newVideo.id;
            }

            render();
            save();
        }

        function deleteCurrentFolder() {
            const folder = appData.folders.find(f => f.id === appData.activeFolderId);
            if (!folder) return;
            
            if (confirm(`Delete folder "${folder.name}" and all its videos?`)) {
                appData.folders = appData.folders.filter(f => f.id !== appData.activeFolderId);
                if (appData.folders.length > 0) {
                    appData.activeFolderId = appData.folders[0].id;
                } else {
                    appData.activeFolderId = null;
                }
                appData.activeVideoId = null;
                render();
                save();
            }
        }

        function deleteVideo(videoId) {
            const activeFolder = appData.folders.find(f => f.id === appData.activeFolderId);
            if (!activeFolder) return;

            if (confirm("Remove this video from the playlist?")) {
                activeFolder.videos = activeFolder.videos.filter(v => v.id !== videoId);
                if (appData.activeVideoId === videoId) {
                    appData.activeVideoId = null;
                }
                render();
                save();
            }
        }

        // Rename Logic
        function openModal(type) {
            document.getElementById(`modal-${type}`).classList.remove('hidden');
            if (type === 'folder') document.getElementById('input-folder-name').focus();
            if (type === 'video') document.getElementById('input-video-url').focus();
        }

        function editCurrentFolder() {
            const folder = appData.folders.find(f => f.id === appData.activeFolderId);
            if (!folder) return;
            
            startRename('folder', folder.id, folder.name);
        }

        function renameVideo(videoId) {
            const folder = appData.folders.find(f => f.id === appData.activeFolderId);
            const video = folder.videos.find(v => v.id === videoId);
            if (video) startRename('video', videoId, video.title);
        }

        function startRename(type, id, currentValue) {
            const modal = document.getElementById('modal-rename');
            document.getElementById('rename-type').value = type;
            document.getElementById('rename-id').value = id;
            const input = document.getElementById('input-rename-value');
            input.value = currentValue;
            
            modal.classList.remove('hidden');
            input.focus();
        }

        function saveRename() {
            const type = document.getElementById('rename-type').value;
            const id = document.getElementById('rename-id').value;
            const newValue = document.getElementById('input-rename-value').value.trim();

            if (!newValue) return;

            if (type === 'folder') {
                const folder = appData.folders.find(f => f.id === id);
                if (folder) folder.name = newValue;
            } else if (type === 'video') {
                const folder = appData.folders.find(f => f.id === appData.activeFolderId);
                const video = folder.videos.find(v => v.id === id);
                if (video) video.title = newValue;
            }

            closeModals();
            render();
            save();
        }

        function closeModals() {
            document.querySelectorAll('[id^="modal-"]').forEach(m => m.classList.add('hidden'));
        }

        // --- Utility: Escape HTML to prevent XSS ---
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // --- Run ---
        window.addEventListener('load', init);

    </script>
</body>
</html>
